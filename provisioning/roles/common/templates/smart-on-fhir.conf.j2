#!upstart
description "FHIR API"
author      "Josh Mandel"

setuid {{username}}
setgid {{username}}

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5

env BASE_URL={{fhir_server.public.base}}
env AUTH={{fhir_server.use_auth|default('false')}}
env INTROSPECTION_URI={{fhir_server.introspection_uri|default('')}}
env REGISTER_URI={{fhir_server.register_uri|default('')}}
env AUTHORIZE_URI={{fhir_server.authorize_uri|default('')}}
env TOKEN_URI={{fhir_server.token_uri|default('')}}
env JAVA_HOME={{java_home_dir}}

script
    chdir {{install_dir}}/smart-on-fhir/target
    java \
       -jar {{install_dir}}/jetty-runner.jar --host localhost --port 3000 \
       fhir-0.1.war
end script
